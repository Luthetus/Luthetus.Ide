@using Luthetus.Common.RazorLib.Dimensions;
@using Luthetus.TextEditor.RazorLib.Keymaps.Models;
@using Luthetus.TextEditor.RazorLib.TextEditors.Models.Internals;
@using Luthetus.Common.RazorLib.Dimensions.Models;

@{ var renderBatchLocal = RenderBatch; }

@if (renderBatchLocal is not null)
{
	var leftRelativeToParentInPixelsCssStyle = string.Empty;
    var textEditorKeymap = (ITextEditorKeymap)renderBatchLocal.Options!.Keymap!;
    
    if (!renderBatchLocal.Options!.UseMonospaceOptimizations)
	{
	    var leftRelativeToParentInPixelsCssValue = _leftRelativeToParentInPixels.ToCssValue();
	    leftRelativeToParentInPixelsCssStyle = $"left: {leftRelativeToParentInPixelsCssValue}px !important;";
	}
	
	<textarea @ref="_cursorDisplayElementReference"
	          @onkeydown="HandleOnKeyDown"
	          id="@CursorDisplayId"
	          tabindex="@GetTabIndex()"
	          class="luth_te_text-editor-cursor @BlinkAnimationCssClass @(textEditorKeymap.GetCursorCssClassString())"
	          style="@CursorStyleCss @leftRelativeToParentInPixelsCssStyle">
	</textarea>
	
	<div class="luth_te_text-editor-caret-row"
	     style="@CaretRowStyleCss">
	</div>
	
	if (renderBatchLocal.ViewModel.MenuKind != MenuKind.None && IncludeContextMenuHelperComponent)
	{
	    <div @onkeydown:stopPropagation="true"
	         @onmousedown:stopPropagation="true"
	         @onmousemove:stopPropagation="true"
	         class="luth_te_text-editor-context-menu"
	         style="@MenuStyleCss">
	
	        <CascadingValue Name="TextEditorMenuShouldTakeFocusFunc"
	                        Value="TextEditorMenuShouldTakeFocus">
	
	            @switch (renderBatchLocal.ViewModel.MenuKind)
	            {
	                case MenuKind.ContextMenu:
	                        @OnContextMenuRenderFragment
	                    break;
	                case MenuKind.AutoCompleteMenu:
	                        @AutoCompleteMenuRenderFragment
	                    break;
	            }
	        </CascadingValue>
	    </div>
	}
}
